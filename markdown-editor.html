<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°ˆæ¥­ Markdown ç·¨è¼¯å™¨ - Tiny Tools</title>
    <!-- å¼•å…¥ Vditor çš„ CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vditor/dist/index.css" />
    <style>
        :root {
            --primary-color: #0366d6;
            --bg-color: #f6f8fa;
            --border-color: #d1d5da;
        }
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
        }
        #app {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 16px;
            background-color: #24292e;
            color: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12);
            z-index: 100;
        }
        .logo {
            font-size: 18px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .actions {
            display: flex;
            gap: 10px;
        }
        .btn {
            padding: 6px 12px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .btn-primary { background-color: #28a745; color: white; }
        .btn-primary:hover { background-color: #218838; }
        .btn-secondary { background-color: #e1e4e8; color: #24292e; }
        .btn-secondary:hover { background-color: #d1d5da; }
        .btn-outline { background-color: transparent; border: 1px solid #e1e4e8; color: #e1e4e8; }
        .btn-outline:hover { background-color: rgba(255,255,255,0.1); }
        
        #vditor-wrapper {
            flex: 1;
            overflow: hidden;
        }
        
        /* éš±è—é è¨­æª”æ¡ˆè¼¸å…¥ */
        #file-input { display: none; }

        /* æç¤ºè¨Šæ¯æ¨£å¼ */
        #toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #24292e;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            z-index: 1000;
        }
    </style>
</head>
<body>

<div id="app">
    <header>
        <div class="logo">
            <span>ğŸ“ Markdown Editor</span>
        </div>
        <div class="actions">
            <button class="btn btn-outline" onclick="document.getElementById('file-input').click()">
                ğŸ“‚ è¼‰å…¥æª”æ¡ˆ
            </button>
            <input type="file" id="file-input" accept=".md,.txt" onchange="handleFileUpload(event)">
            <button class="btn btn-secondary" onclick="copyToClipboard()">
                ğŸ“‹ è¤‡è£½å…§å®¹
            </button>
            <button class="btn btn-primary" onclick="downloadMarkdown()">
                ğŸ’¾ ä¸‹è¼‰ .md
            </button>
            <button class="btn btn-secondary" style="background-color: #f85149; color: white;" onclick="resetEditor()">
                ğŸ—‘ï¸ æ¸…é™¤
            </button>
        </div>
    </header>

    <div id="vditor-wrapper">
        <div id="vditor"></div>
    </div>
</div>

<div id="toast">å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿</div>

<!-- å¼•å…¥ Vditor JS -->
<script src="https://cdn.jsdelivr.net/npm/vditor/dist/index.min.js"></script>

<script>
    let vditor;
    let currentFileName = 'untitled.md';

    // åˆå§‹åŒ– Vditor
    window.onload = () => {
        vditor = new Vditor('vditor', {
            height: '100%',
            mode: 'sv', // å³æ™‚é è¦½æ¨¡å¼
            theme: 'classic',
            icon: 'ant-design',
            placeholder: 'åœ¨æ­¤è¼¸å…¥ Markdown å…§å®¹ï¼Œæˆ–æ‹–æ›³æª”æ¡ˆåˆ°é€™è£¡...',
            outline: {
                enable: true,
                position: 'left',
            },
            toolbarConfig: {
                pin: true,
            },
            cache: {
                enable: false, // é—œé–‰å¿«å–ï¼Œå¯¦ç¾ç”¨å®Œå³èµ°
            },
            preview: {
                delay: 100,
                hljs: { style: 'github' },
                actions: ["desktop", "tablet", "mobile", "outline", "both", "preview"]
            },
            after: () => {
                console.log('Vditor initialized');
                // è¨­ç½®åˆå§‹å…§å®¹ï¼ˆå¯é¸ï¼‰
                const welcomeText = "# æ­¡è¿ä½¿ç”¨ Markdown ç·¨è¼¯å™¨\n\næ‚¨å¯ä»¥ï¼š\n1. **é»æ“Šä¸Šæ–¹æŒ‰éˆ•** è¼‰å…¥æœ¬åœ°æª”æ¡ˆ\n2. **ç›´æ¥æ‹–æ›³** æª”æ¡ˆåˆ°æ­¤å€åŸŸ\n3. **å³æ™‚é è¦½** ä¸¦ä½¿ç”¨å·¦å´å¤§ç¶±å°èˆª\n\n---\n\n### æ¸¬è©¦æ‘ºç–ŠåŠŸèƒ½\né»æ“Šæ¨™é¡Œå·¦å´çš„å°ç®­é ­å³å¯æ‘ºç–Šå€å¡Šã€‚";
                vditor.setValue(welcomeText);
            }
        });

        // ç›£è½æ‹–æ›³äº‹ä»¶
        const wrapper = document.getElementById('vditor-wrapper');
        wrapper.addEventListener('dragover', (e) => {
            e.preventDefault();
            e.stopPropagation();
        });
        wrapper.addEventListener('drop', (e) => {
            e.preventDefault();
            e.stopPropagation();
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });
    };

    // è™•ç†æª”æ¡ˆä¸Šå‚³
    function handleFileUpload(event) {
        const file = event.target.files[0];
        handleFile(file);
    }

    function handleFile(file) {
        if (!file) return;
        if (!file.name.endsWith('.md') && !file.name.endsWith('.txt')) {
            showToast('åƒ…æ”¯æ´ .md æˆ– .txt æª”æ¡ˆ');
            return;
        }
        const reader = new FileReader();
        reader.onload = (e) => {
            vditor.setValue(e.target.result);
            currentFileName = file.name;
            showToast(`å·²è¼‰å…¥: ${file.name}`);
        };
        reader.readAsText(file);
    }

    // è¤‡è£½åˆ°å‰ªè²¼ç°¿
    function copyToClipboard() {
        const content = vditor.getValue();
        navigator.clipboard.writeText(content).then(() => {
            showToast('å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿');
        }).catch(err => {
            console.error('ç„¡æ³•è¤‡è£½: ', err);
        });
    }

    // ä¸‹è¼‰æª”æ¡ˆ
    function downloadMarkdown() {
        const content = vditor.getValue();
        const blob = new Blob([content], { type: 'text/markdown' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = currentFileName;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        showToast('æª”æ¡ˆå·²æº–å‚™ä¸‹è¼‰');
    }

    // é‡ç½®ç·¨è¼¯å™¨
    function resetEditor() {
        if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰å…§å®¹å—ï¼Ÿ')) {
            vditor.setValue('');
            currentFileName = 'untitled.md';
            showToast('å·²é‡ç½®');
        }
    }

    // é¡¯ç¤ºæç¤ºè¨Šæ¯
    function showToast(message) {
        const toast = document.getElementById('toast');
        toast.textContent = message;
        toast.style.opacity = '1';
        setTimeout(() => {
            toast.style.opacity = '0';
        }, 2000);
    }
</script>

</body>
</html>
